{% extends 'base.html' %}

{% block title%}
<h3>Property Details</h3>
{% endblock %}

{% block content %}
<div class="card">
    <div class="card-content">
        {% for photo in property.photo_set.all %}
            <img class="responsive-img property-img" src="{{photo.photo_url}}">
        {% empty %}
            <div class="card-panel teal-text center-align">No Photos Uploaded</div>
        {% endfor %}
    </div>
    {% if property.user == request.user %}
    <div class="card-action">
        <form action="{% url 'add_photo' property.id %}" enctype="multipart/form-data" method="POST">
            {% csrf_token %}
            <input type="file" name="photo-file">
            <br><br>
            <input type="submit" class="btn btn-sm btn-outline-primary" value="Add Photo">
        </form>
    </div>
    {% endif %}
</div>
<div>
    <div>
        <h3>{{property.title}}</h3>
        <p>{{property.description}}</p>
        <p>{{property.location}}</p>
        <p>{{property.price}} CAD per night</p>
    </div>
    <p>Posted by {{property.user.username}} on {{property.date_listed}}.</p> <!--Add link to creator profile-->
    {% if property.user == request.user %}
    <div class="card-action">
        <a class="text-decoration-none" href="{% url 'property_update' property.id %}"><button class="btn btn-primary">Edit</button></a>
        <a class="text-decoration-none" href="{% url 'property_delete' property.id %}"><button class="btn btn-danger">Delete</button></a>
    </div>
    {% endif %}
    <div>
        <h4>Listed Property Features:</h4>
        <table>
            {% for property_feature in property.property_features.all %}
                <tr>
                    <td>
                        {{property_feature.feature}}

                    </td>

                    {% if property.user == request.user %}
                        <td class="">
                            <form action="{% url 'dissociate_property_feature' property.id property_feature.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-small btn-danger">X</button>
                            </form>
                        </td>
                    {% endif %}
                </tr>
            {% empty %}
                <div>No features listed on this property</div>
            {% endfor %}
        </table>
    </div>
    {% if property.user == request.user %}
    <div>
        <h4>Add Features to Properties</h4>
        <table>
            {% for property_feature in features_property_doesnt_have.all %}
                <tr>
                    <td>
                        {{property_feature.feature}}
                    </td>
                    <td class="">
                        <form action="{% url 'associate_property_feature' property.id property_feature.id %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-small btn-success">Add</button>
                        </form>
                    </td>
                </tr>
            {% empty %}
                <div>All available features are listed on this property</div>
            {% endfor %}
        </table>
    </div>
    {% endif %}

    <!-- Availabilit -->
     <div style="margin-top:80px">
        <h4>Availability to Properties</h4>
        {% for availability in property.availability_set.all %}
        <div>
            <br>
            Booking Date:
            <br>
            {{availability.from_date}}
            <br>
            {{availability.till_date}}
            <form action="{% url 'delete_availability' property.id availability.id %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="Delete an Available">
            </form>
            <a href="{% url 'update_availability' availability.id %}">Update an Available</a>
        {% endfor %}
        </div>
        <div>
            <form action="{% url 'add_availability' property.id %}" method="post">
                {% csrf_token %}
                {{availability_form.as_table}}
                <input type="submit" class="btn-primary" value="Add Avaibility">
            </form>
        </div>
    </div>
    

</div>
{% endblock %}